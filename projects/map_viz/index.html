<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7REHTK4CJ8"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-7REHTK4CJ8');
    </script>
    <!-- Standard Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Building Tool</title>

    <!-- External Libraries & Dependencies -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    
    <!-- Favicon & Apple Icons -->
    <link rel="icon" type="image/png" href="/chadvo-ds-website/assets/img/favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/chadvo-ds-website/assets/img/favicon.png">
    <!-- Global Stylesheets -->
    <link rel="stylesheet" href="../../css/style.css">
    
    <!-- Page-Specific Stylesheets -->
    <link rel="stylesheet" href="src/ui/map_styles.css">
</head>

<body>
    <!-- Header Navigation -->
    <header id="stickyHeader" class="sticky-header"></header>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar Controls -->
                <div class="col-md-4 col-lg-3 sidebar">
                    <h2>Map Shading Tool</h2>
                    
                    <!-- Geography Level Selection -->
                    <div class="section-title">GEOGRAPHY LEVEL</div>
                    <div class="mb-3">
                        <select id="geo-level" class="form-select">
                            <option value="states">States</option>
                            <option value="counties">Counties</option>
                            <option value="cbsas">CBSAs (Metro Areas)</option>
                            <option value="zips">ZIP Codes</option>  
                        </select>
                    </div>

                    <!-- Region Search & Selection -->
                    <div class="section-title">SELECT REGIONS</div>
                    <div class="mb-3">
                        <input type="text" id="search-input" class="form-control mb-2" placeholder="Search regions...">
                        <div id="region-checkboxes" class="region-checkboxes">
                            </div>
                    </div>

                    <!-- Data Visualization & Metrics -->
                    <div class="section-title">DATA VISUALIZATION</div>
                    <div class="mb-3">
                        <label class="form-label">
                            Metric to Display 
                            <i class="fas fa-info-circle metric-info-icon" id="metric-info-icon"></i>
                        </label>
                        <div class="metric-tooltip" id="metric-tooltip">
                            <div class="metric-tooltip-title"></div>
                            <div class="metric-tooltip-definition"></div>
                            <div class="metric-tooltip-source"></div>
                        </div>                        
                        <select id="metric-selector" class="form-select">
                            <option value="none">None (Manual Selection)</option>
                            
                            <optgroup label="Economic Indicators">
                                <option value="medianHouseholdIncome">Median Household Income (Census)</option>
                                <option value="povertyRate">Poverty Rate (%)</option>
                                <option value="gdpTotal">GDP Total (Millions)</option>
                            </optgroup>

                            <optgroup label="Employment & Demographics">
                                <option value="employmentRate">Employment Rate (%)</option>
                                <option value="unemploymentRate">Unemployment Rate (%)</option>
                                <option value="totalPopulation">Total Population</option>
                                <option value="medianAge">Median Age</option>
                            </optgroup>
                            
                            <optgroup label="Housing Market">
                                <option value="medianHomeValue">Median Home Value</option>
                                <option value="medianGrossRent">Median Gross Rent</option>
                                <option value="medianOwnerCostsWithMortgage">Monthly Owner Costs (Mortgage)</option>
                                <option value="medianOwnerCostsNoMortgage">Monthly Owner Costs (No Mortgage)</option>
                            </optgroup>

                            <optgroup label="Housing Characteristics">
                                <option value="homeownershipRate">Homeownership Rate (%)</option>
                                <option value="vacancyRate">Vacancy Rate (%)</option>
                                <option value="medianYearBuilt">Median Year Built</option>
                                <option value="totalHousingUnits">Total Housing Units</option>
                            </optgroup>

                            <optgroup label="HUD Fair Market Rents (2025/26)">
                                <option value="fmr0Bedroom">Studio/Efficiency FMR</option>
                                <option value="fmr1Bedroom">1-Bedroom FMR</option>
                                <option value="fmr2Bedroom">2-Bedroom FMR</option>
                                <option value="fmr3Bedroom">3-Bedroom FMR</option>
                                <option value="fmr4Bedroom">4-Bedroom FMR</option>
                                <option value="medianFamilyIncome">Median Family Income (HUD)</option>
                            </optgroup>

                            <optgroup label="Redfin Housing Market (2025)">
                                <option value="MEDIAN_SALE_PRICE">Median Sale Price</option>
                                <option value="MEDIAN_SALE_PRICE_YOY">Price YoY Change (%)</option>
                                <option value="HOMES_SOLD">Homes Sold</option>
                                <option value="INVENTORY">Current Inventory</option>
                                <option value="MEDIAN_DOM">Median Days on Market</option>
                            </optgroup>
                        </select>
                        
                        <div class="metric-help" id="metric-help"></div>
                        
                        <div class="metric-source-info" style="margin-top: 5px;">
                            <small style="font-size: 10px; color: #999;">
                                Sources: Census ACS (5-Year), BEA Regional, HUD User Data
                            </small>
                        </div>
                    </div>

                    <!-- Choropleth Color Settings -->
                    <div id="choropleth-settings" style="display: none;">
                        <div class="section-title">CHOROPLETH COLORS</div>
                        <div class="mb-3">
                            <label class="form-label">Low Value Color</label>
                            <div class="color-input-group">
                                <input type="color" id="choro-low-color" class="form-control-color" value="#eff3ff">
                                <input type="text" id="choro-low-hex" class="form-control form-control-sm" value="#EFF3FF">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">High Value Color</label>
                            <div class="color-input-group">
                                <input type="color" id="choro-high-color" class="form-control-color" value="#08519c">
                                <input type="text" id="choro-high-hex" class="form-control form-control-sm" value="#08519C">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Shading Opacity: <span id="opacity-value">100</span>%</label>
                            <input type="range" class="form-range" id="choro-opacity" min="0" max="100" value="100" step="5">
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="enhance-labels" checked>
                                <label class="form-check-label" for="enhance-labels">
                                    Enhanced Label Visibility
                                </label>
                            </div>
                            <small class="text-muted" style="font-size: 11px; display: block; margin-top: 4px;">
                                Adds white outline to map labels for better readability
                            </small>
                        </div>
                    </div>

                    <!-- Border & Selection Colors -->
                    <div class="section-title">COLOR SETTINGS</div>
                    <div class="mb-3">
                        <label class="form-label">Border Color</label>
                        <div class="color-input-group">
                            <input type="color" id="border-color" class="form-control-color" value="#999999">
                            <input type="text" id="border-color-hex" class="form-control form-control-sm" value="#999999">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Selected Area Color</label>
                        <div class="color-input-group">
                            <input type="color" id="selected-color" class="form-control-color" value="#627BC1">
                            <input type="text" id="selected-color-hex" class="form-control form-control-sm" value="#627BC1">
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="selected-no-shade">
                            <label class="form-check-label" for="selected-no-shade">
                                No shading
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Non-Selected Area Color</label>
                        <div class="color-input-group">
                            <input type="color" id="dimmed-color" class="form-control-color" value="#CCCCCC">
                            <input type="text" id="dimmed-color-hex" class="form-control form-control-sm" value="#CCCCCC">
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="dimmed-no-shade">
                            <label class="form-check-label" for="dimmed-no-shade">
                                No shading
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Map Container -->
                <div class="col-md-8 col-lg-9 map-container">
                    <!-- Loading Overlay -->
                    <div class="loading-overlay" id="loadingOverlay">
                        <div>
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="mt-3">Loading geographic data...</div>
                        </div>
                    </div>
                    
                    <!-- Map Canvas & Tooltip -->
                    <div id="map"></div>
                    <div class="map-tooltip" id="mapTooltip"></div>

                    <!-- Map Legend -->
                    <div id="map-legend" style="display: none; position: absolute; bottom: 20px; left: 20px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid #dee2e6; border-radius: 8px; padding: 16px; z-index: 1000; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <p style="font-size: 13px; font-weight: 600; margin: 0 0 8px 0; color: #495057;" id="legend-title">Median Household Income</p>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 11px; color: #6c757d;" id="legend-low">Low</span>
                            <div id="legend-gradient" style="width: 120px; height: 16px; border-radius: 4px; background: linear-gradient(to right, #eff3ff, #08519c);"></div>
                            <span style="font-size: 11px; color: #6c757d;" id="legend-high">High</span>
                        </div>
                    </div>

                    <!-- Data Year Badge -->
                    <div id="data-year-badge" style="
                        position: absolute; 
                        top: 2rem; 
                        left: 20px; 
                        background: rgba(255, 255, 255, 0.95); 
                        backdrop-filter: blur(10px);
                        border: 1px solid #dee2e6; 
                        border-radius: 6px; 
                        padding: 8px 14px; 
                        z-index: 1000; 
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        font-size: 12px;
                        color: #495057;
                        font-weight: 500;
                    ">
                        <i class="fas fa-calendar-alt" style="margin-right: 6px; color: #6c757d;"></i>
                        LatestData Year: <strong id="data-year-display">Loading...</strong>
                    </div>

                    <!-- Zoom Controls -->
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoom-in">+</button>
                        <button class="zoom-btn" id="zoom-out">−</button>
                        <button class="zoom-btn" id="zoom-reset">⟲</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <section class="bg-light-blue py-5 text-center footer-section" id="contact"></section>
    
    <!-- Data Notification Toast -->
    <div id="data-notification" class="notification-toast">
        <div class="notification-content">
            <i class="fas fa-exclamation-circle"></i>
            <span id="notification-message">Data not available</span>
        </div>
        <button onclick="closeNotification()" class="notification-close">&times;</button>
    </div>    

    <!-- External Scripts -->
    <script src="../../js/seo-injector.js"></script>
    <script src="../../js/page-config.js"></script>
    <script src="../../js/ui-manager.js"></script>
    <script src="../map_viz/src/js/EconomicMap.js?v=20260130a"></script>
</body>
</html>